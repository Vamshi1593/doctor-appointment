<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Welcome to Patient Dashboard</h1>
    <p id="username-display"></p>
    <h2>Registered Doctors</h2>
    <ul id="doctor-list"></ul>
    <h2>Book an Appointment</h2>
    <form id="appointment-form">
        <select id="doctor-select" required></select>
        <input type="datetime-local" id="appointment-date" required>
        <textarea id="appointment-details" placeholder="Appointment Details" required></textarea>
        <button type="submit">Book Appointment</button>
    </form>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('username');
            document.getElementById('username-display').innerText = `Hello, ${username}`;

            // Fetch registered doctors
            fetch('/doctors')
                .then(response => response.json())
                .then(data => {
                    const doctorList = document.getElementById('doctor-list');
                    const doctorSelect = document.getElementById('doctor-select');
                    data.forEach(doctor => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `Dr. ${doctor.name} - ${doctor.qualification}, ${doctor.hospitalName}`;
                        doctorList.appendChild(listItem);

                        const option = document.createElement('option');
                        option.value = doctor.username;
                        option.textContent = `Dr. ${doctor.name}`;
                        doctorSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching doctors:', error));
            
            // Handle appointment booking
            const appointmentForm = document.getElementById('appointment-form');
            appointmentForm.addEventListener('submit', event => {
                event.preventDefault();
                const doctorUsername = document.getElementById('doctor-select').value;
                const appointmentDate = document.getElementById('appointment-date').value;
                const details = document.getElementById('appointment-details').value;

                fetch('/appointments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ doctorUsername, patientUsername: username, appointmentDate, details })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                })
                .catch(error => console.error('Error booking appointment:', error));
            });
        });
    </script>
</body>
</html>
